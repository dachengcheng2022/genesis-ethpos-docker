version: '2.3'
services:

  eth: &eth
    image: block.com/geth
    build:
      context: .
      dockerfile: execution-docker/Dockerfile
      args:
        PORT_RPC: 8545
        DATA_DIR: "/execution"
        VERSION: v1.13.4
        VALIDATOR_ADDRESS: 0x31dac3e0045b99d519d55644a3070bc7173af471
        <<: &eth_labels
          SYMBOL: eth
      labels:
        <<: *eth_labels
    volumes:
      - ./execution:/execution
    ports:
      - 8551:8551
      - 8545:8545
      - 30303:30303
    depends_on:
      beacon-chain:
        condition: service_started

  beacon-chain: &beacon-chain
    image: block.com/beacon-chain
    build:
      context: .
      dockerfile: consensus-docker/Dockerfile
      args:
        DATA_DIR: "/consensus"
        # VERSION: v4.0.7
        VERSION: v4.1.1
        VALIDATOR_ADDRESS: 0x31dac3e0045b99d519d55644a3070bc7173af471
        PEER_INFO: 
        <<: &beacon_labels
          SYMBOL: beacon
      labels:
        <<: *beacon_labels
    volumes:
      - ./consensus:/consensus
      - ./execution:/execution
    ports:
      - 4000:4000
      - 3500:3500
      - 8080:8080
      - 13000:13000

